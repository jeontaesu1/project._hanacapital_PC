{"version":3,"file":"SimpleInput-994be11c.js","sources":["../../../../src/components/ui/form/SimpleInput.vue"],"sourcesContent":["<script>\nimport {\n  ref,\n  reactive,\n  computed,\n  provide,\n  onBeforeMount,\n  onMounted,\n  onUpdated,\n  useCssModule,\n  watch,\n  nextTick,\n} from 'vue';\n\nimport FormInvalid from '@/components/ui/form/FormInvalid.vue';\n\nconst defaultClassNames = () => ({\n  wrap: '',\n  block: '',\n  input: '',\n  bottom: '',\n  bottomLeft: '',\n  count: '',\n  countCurrent: '',\n});\n\nexport default {\n  components: {\n    FormInvalid,\n  },\n  inheritAttrs: false,\n  props: {\n    classNames: {\n      Type: Object,\n      default() {\n        return defaultClassNames();\n      },\n    },\n    type: {\n      Type: String,\n      default: 'text',\n    },\n    maxlength: {\n      Type: Number,\n      default: null,\n    },\n    readonly: {\n      Type: Boolean,\n      default: false,\n    },\n    disabled: {\n      Type: Boolean,\n      default: false,\n    },\n    align: {\n      Type: String,\n      default: null,\n    },\n    defaultValue: {\n      Type: String,\n      default: null,\n    },\n    modelValue: {\n      Type: String,\n    },\n    count: {\n      Type: Boolean,\n      default: false,\n    },\n    error: {\n      Type: Boolean,\n      default: false,\n    },\n  },\n  setup(props, { slots, emit }) {\n    let timer = null;\n\n    const $style = useCssModule();\n\n    const state = reactive({\n      isFocus: false,\n      isInputed: false,\n      val: '',\n      count: props.modelValue ? props.modelValue.length : 0,\n    });\n\n    const input = ref(null);\n\n    const customClassNames = computed(() => {\n      const { classNames } = props;\n      return Object.assign(defaultClassNames(), classNames);\n    });\n\n    const isBottom = computed(() => {\n      return Boolean(slots.bottom);\n    });\n\n    const getInputElement = () => {\n      return input.value;\n    };\n\n    const focus = () => {\n      input.value.focus();\n    };\n\n    const checkLength = () => {\n      const { maxlength } = props;\n\n      if (typeof maxlength !== 'number') return;\n\n      const val = input.value.value;\n\n      if (val.length > maxlength) {\n        input.value.value = val.substr(0, maxlength);\n\n        const eInput = new Event('input');\n        input.value.dispatchEvent(eInput);\n      }\n    };\n\n    const checkInputed = () => {\n      const length = input.value.value.length;\n      state.isInputed = length ? true : false;\n      state.count = length;\n    };\n\n    const onfocusin = () => {\n      clearTimeout(timer);\n      checkLength();\n      state.isFocus = true;\n      state.isInputed = input.value.value.length ? true : false;\n    };\n\n    const onfocusout = () => {\n      clearTimeout(timer);\n      checkLength();\n\n      timer = setTimeout(() => {\n        state.isFocus = false;\n        clearTimeout(timer);\n      }, 50);\n    };\n\n    const onInput = (e) => {\n      const { value } = e.target;\n      state.val = value;\n      emit('update:modelValue', value);\n    };\n\n    const onKeydown = () => {\n      checkLength();\n    };\n\n    const onKeyup = () => {\n      checkLength();\n      checkInputed();\n    };\n\n    onBeforeMount(() => {\n      state.val = props.modelValue || props.defaultValue || '';\n    });\n\n    onMounted(() => {\n      checkLength();\n      checkInputed();\n    });\n\n    onUpdated(() => {\n      checkLength();\n    });\n\n    watch(\n      () => props.modelValue,\n      (cur) => {\n        state.val = cur;\n\n        nextTick(() => {\n          checkInputed();\n        });\n      }\n    );\n\n    provide('simpleInput', {\n      helpClass: $style['input__help'],\n      invalidClass: $style['input__invalid'],\n    });\n\n    return {\n      state,\n      input,\n      customClassNames,\n      isBottom,\n      getInputElement,\n      focus,\n      onfocusin,\n      onInput,\n      onKeydown,\n      onKeyup,\n      onfocusout,\n    };\n  },\n};\n</script>\n\n<template>\n  <div\n    :class=\"[\n      $style['input'],\n      {\n        [$style['input--focus']]: state.isFocus,\n        [$style['input--inputed']]: state.isInputed,\n        [$style['input--error']]: error,\n        [$style['input--disabled']]: disabled,\n      },\n      customClassNames.wrap,\n    ]\"\n  >\n    <FormInvalid :error=\"error\" :disabled=\"disabled\">\n      <div\n        :class=\"[$style['input__block'], customClassNames.block]\"\n        @focusin=\"onfocusin\"\n        @focusout=\"onfocusout\"\n      >\n        <input\n          ref=\"input\"\n          v-bind=\"$attrs\"\n          :type=\"type\"\n          :class=\"[\n            $style['input__input'],\n            {\n              [$style[`input__input--align-${align}`]]: align,\n            },\n            customClassNames.input,\n          ]\"\n          :value=\"modelValue || state.val\"\n          :disabled=\"disabled\"\n          :readonly=\"readonly\"\n          @input=\"onInput\"\n          @keydown=\"onKeydown\"\n          @keyup=\"onKeyup\"\n        />\n      </div>\n      <div\n        v-if=\"isBottom || count\"\n        :class=\"[$style['input__bottom'], customClassNames.bottom]\"\n      >\n        <div\n          v-if=\"isBottom\"\n          :class=\"[$style['input__bottom-left'], customClassNames.bottom]\"\n        >\n          <slot name=\"bottom\" />\n        </div>\n        <div\n          v-if=\"count\"\n          :class=\"[$style['input__count'], customClassNames.bottom]\"\n        >\n          <span\n            :class=\"[\n              $style['input__count-current'],\n              customClassNames.countCurrent,\n            ]\"\n            >{{ state.count }}</span\n          ><span v-if=\"maxlength\">/{{ maxlength }}</span>\n        </div>\n      </div>\n    </FormInvalid>\n  </div>\n</template>\n\n<style lang=\"scss\" module>\n@import '@/assets/scss/components/ui/form/SimpleInput.scss';\n</style>\n"],"names":["defaultClassNames","_sfc_main","FormInvalid","props","slots","emit","timer","$style","useCssModule","state","reactive","input","ref","customClassNames","computed","classNames","isBottom","getInputElement","focus","checkLength","maxlength","val","eInput","checkInputed","length","onfocusin","onfocusout","onInput","e","value","onKeydown","onKeyup","onBeforeMount","onMounted","onUpdated","watch","cur","nextTick","provide","_createElementBlock","_normalizeClass","_ctx","$setup","$props","_createVNode","_component_FormInvalid","_createElementVNode","args","_mergeProps","_renderSlot","_toDisplayString","_hoisted_2"],"mappings":"+gCAgBMA,EAAoB,KAAO,CAC/B,KAAM,GACN,MAAO,GACP,MAAO,GACP,OAAQ,GACR,WAAY,GACZ,MAAO,GACP,aAAc,EAChB,GAEKC,EAAU,CACb,WAAY,CACV,YAAAC,CACD,EACD,aAAc,GACd,MAAO,CACL,WAAY,CACV,KAAM,OACN,SAAU,CACR,OAAOF,EAAiB,CACzB,CACF,EACD,KAAM,CACJ,KAAM,OACN,QAAS,MACV,EACD,UAAW,CACT,KAAM,OACN,QAAS,IACV,EACD,SAAU,CACR,KAAM,QACN,QAAS,EACV,EACD,SAAU,CACR,KAAM,QACN,QAAS,EACV,EACD,MAAO,CACL,KAAM,OACN,QAAS,IACV,EACD,aAAc,CACZ,KAAM,OACN,QAAS,IACV,EACD,WAAY,CACV,KAAM,MACP,EACD,MAAO,CACL,KAAM,QACN,QAAS,EACV,EACD,MAAO,CACL,KAAM,QACN,QAAS,EACV,CACF,EACD,MAAMG,EAAO,CAAE,MAAAC,EAAO,KAAAC,CAAK,EAAG,CAC5B,IAAIC,EAAQ,KAEZ,MAAMC,EAASC,IAETC,EAAQC,EAAS,CACrB,QAAS,GACT,UAAW,GACX,IAAK,GACL,MAAOP,EAAM,WAAaA,EAAM,WAAW,OAAS,CACtD,CAAC,EAEKQ,EAAQC,EAAI,IAAI,EAEhBC,EAAmBC,EAAS,IAAM,CACtC,KAAM,CAAE,WAAAC,CAAW,EAAIZ,EACvB,OAAO,OAAO,OAAOH,EAAmB,EAAEe,CAAU,CACtD,CAAC,EAEKC,EAAWF,EAAS,IACjB,EAAQV,EAAM,MACtB,EAEKa,EAAkB,IACfN,EAAM,MAGTO,EAAQ,IAAM,CAClBP,EAAM,MAAM,SAGRQ,EAAc,IAAM,CACxB,KAAM,CAAE,UAAAC,CAAY,EAAEjB,EAEtB,GAAI,OAAOiB,GAAc,SAAU,OAEnC,MAAMC,EAAMV,EAAM,MAAM,MAExB,GAAIU,EAAI,OAASD,EAAW,CAC1BT,EAAM,MAAM,MAAQU,EAAI,OAAO,EAAGD,CAAS,EAE3C,MAAME,EAAS,IAAI,MAAM,OAAO,EAChCX,EAAM,MAAM,cAAcW,CAAM,CAClC,GAGIC,EAAe,IAAM,CACzB,MAAMC,EAASb,EAAM,MAAM,MAAM,OACjCF,EAAM,UAAY,EAAAe,EAClBf,EAAM,MAAQe,GAGVC,EAAY,IAAM,CACtB,aAAanB,CAAK,EAClBa,IACAV,EAAM,QAAU,GAChBA,EAAM,UAAY,EAAAE,EAAM,MAAM,MAAM,QAGhCe,EAAa,IAAM,CACvB,aAAapB,CAAK,EAClBa,IAEAb,EAAQ,WAAW,IAAM,CACvBG,EAAM,QAAU,GAChB,aAAaH,CAAK,CACnB,EAAE,EAAE,GAGDqB,EAAWC,GAAM,CACrB,KAAM,CAAE,MAAAC,GAAUD,EAAE,OACpBnB,EAAM,IAAMoB,EACZxB,EAAK,oBAAqBwB,CAAK,GAG3BC,EAAY,IAAM,CACtBX,KAGIY,EAAU,IAAM,CACpBZ,IACAI,KAGF,OAAAS,EAAc,IAAM,CAClBvB,EAAM,IAAMN,EAAM,YAAcA,EAAM,cAAgB,EACxD,CAAC,EAED8B,EAAU,IAAM,CACdd,IACAI,GACF,CAAC,EAEDW,EAAU,IAAM,CACdf,GACF,CAAC,EAEDgB,EACE,IAAMhC,EAAM,WACXiC,GAAQ,CACP3B,EAAM,IAAM2B,EAEZC,EAAS,IAAM,CACbd,GACF,CAAC,CACH,GAGFe,EAAQ,cAAe,CACrB,UAAW/B,EAAO,YAClB,aAAcA,EAAO,cACvB,CAAC,EAEM,CACL,MAAAE,EACA,MAAAE,EACA,iBAAAE,EACA,SAAAG,EACA,gBAAAC,EACA,MAAAC,EACA,UAAAO,EACA,QAAAE,EACA,UAAAG,EACA,QAAAC,EACA,WAAAL,EAEH,CACH,oHAIEa,EA6DM,MAAA,CA5DH,MAAKC,EAAA,CAAUC,EAAM,OAAA,QAA4BA,EAAM,OAAA,cAAA,CAAA,EAAmBC,EAAK,MAAC,SAAkBD,EAAM,OAAA,gBAAA,CAAA,EAAqBC,EAAK,MAAC,UAAoB,CAAAD,EAAA,wBAAyBE,EAAK,MAAW,CAAAF,EAAA,2BAA4BE,EAAQ,UAAiBD,EAAA,iBAAiB,SAWvQE,EAgDcC,EAAA,CAhDA,MAAOF,EAAK,MAAG,SAAUA,EAAQ,qBAC7C,IAuBM,CAvBNG,EAuBM,MAAA,CAtBH,MAAQN,EAAA,CAAAC,EAAA,OAAwB,aAAAC,EAAA,iBAAiB,KAAK,CAAA,EACtD,8BAASA,EAAS,WAAAA,EAAA,UAAA,GAAAK,CAAA,GAClB,+BAAUL,EAAU,YAAAA,EAAA,WAAA,GAAAK,CAAA,KAErBD,EAiBE,QAjBFE,EAiBE,CAhBA,IAAI,SACIP,EAAM,OAAA,CACb,KAAME,EAAI,KACV,MAAK,CAAgBF,EAAM,OAAA,eAA+CA,EAAM,OAAA,uBAAwBE,EAAK,KAAA,EAAA,CAAA,EAAMA,EAAK,OAA6BD,EAAA,iBAAiB,OAOtK,MAAOC,EAAA,YAAcD,EAAA,MAAM,IAC3B,SAAUC,EAAQ,SAClB,SAAUA,EAAQ,SAClB,4BAAOD,EAAO,SAAAA,EAAA,QAAA,GAAAK,CAAA,GACd,8BAASL,EAAS,WAAAA,EAAA,UAAA,GAAAK,CAAA,GAClB,4BAAOL,EAAO,SAAAA,EAAA,QAAA,GAAAK,CAAA,sBAIXL,EAAA,UAAYC,EAAK,WADzBJ,EAsBM,MAAA,OApBH,MAAQC,EAAA,CAAAC,EAAA,OAAyB,cAAAC,EAAA,iBAAiB,MAAM,CAAA,IAGjDA,EAAQ,cADhBH,EAKM,MAAA,OAHH,MAAQC,EAAA,CAAAC,EAAA,OAA8B,oBAAA,EAAAC,EAAA,iBAAiB,MAAM,CAAA,IAE9DO,EAAsBR,EAAA,OAAA,QAAA,gBAGhBE,EAAK,WADbJ,EAWM,MAAA,OATH,MAAQC,EAAA,CAAAC,EAAA,OAAwB,aAAAC,EAAA,iBAAiB,MAAM,CAAA,IAExDI,EAMC,OAAA,CALE,MAAKN,EAAA,CAAkBC,EAAM,OAAA,sBAAA,EAAwCC,EAAA,iBAAiB,cAInF,EAAAQ,EAAAR,EAAA,MAAM,KAAK,EAAA,CAAA,EACJC,EAAS,eAArBJ,EAA8C,OAAAY,GAAvB,IAACD,EAAGP,EAAS,SAAA,EAAA,CAAA"}